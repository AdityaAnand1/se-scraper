Ya.define("static/features/Images/Images@desktop.en.js",["react-with-dom"],function(){!function(e){function t(t){for(var i,o,s=t[0],c=t[1],u=t[2],d=0,h=[];d<s.length;d++)o=s[d],r[o]&&h.push(r[o][0]),r[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(l&&l(t);h.length;)h.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(i=!1)}i&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},r={328:0},a=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="//yastatic.net/s3/web4static/_/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;a.push([1617,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,18,19,21,22,23,31,33,40,41,60,82,134,145,0]),n()}({0:function(e,t){e.exports=React},136:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(4),r=Object(i.cn)("Images")},15:function(e,t){e.exports=ReactDOM},16:function(e,t,n){n.r(t);var i=n(6);Object(i.setI18nLang)("en")},1617:function(e,t,n){n(16),e.exports=n(3067)},3067:function(e,t,n){"use strict";n.r(t);var i=n(1),r=n(0),a=n.n(r),o=n(2),s=n(12),c=n(334),u=n(496),l=n(3338),d=n(3),h=n(361),p=Object(d.withBemMod)(Object(h.b)(),{lazy:!0},function(e){return function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={children:e.getFirstRenderChildren(),hideMore:!0},e}return i.__extends(n,t),n.prototype.componentDidMount=function(){this.setState({children:this.props.children,hideMore:!1})},n.prototype.getFirstRenderChildren=function(){var e=this.props.lazyConfig||{},t=e.rowsCount,n=e.thumbsCount,i=this.props.children;return"undefined"!==typeof t?i=i.slice(0,Math.min(i.length,t)):"undefined"!==typeof n&&(i=i.map(function(e){return e.slice(0,Math.min(e.length,n))})),i},n.prototype.render=function(){return a.a.createElement(e,i.__assign({},this.props),this.state.children)},n}(a.a.PureComponent)}),g=n(136),f=p(l.a),b=new o.Registry({id:Object(g.a)()});b.set("Gallery",f);var m=c.a.merge(b);n.d(t,"App",function(){return y});var w={lazyLoad:{1:m}},y=Object(s.a)("Images")(function(e){var t=[c.a];for(var n in e.experiments){var r=n,s=e.experiments[r];if(s){var l=w[r][s];l&&t.push(l)}}var d=o.withRegistry.apply(void 0,i.__spread(t))(u.a);return a.a.createElement(d,i.__assign({},e))})},334:function(e,t,n){"use strict";n.d(t,"a",function(){return p});var i=n(2),r=n(30),a=n(3390),o=n(559),s=n(3338),c=n(584),u=n(609),l=n(136),d=Object(a.a)(o.a),h=Object(u.a)(c.a),p=new i.Registry({id:Object(l.a)()});p.set("SerpOrganic",r.a),p.set("Thumb",d),p.set("Gallery",s.a),p.set("Fold",h)},496:function(e,t,n){"use strict";var i=n(1),r=n(0),a=n.n(r),o=n(3),s=n(2),c=n(7),u=n(136),l=Object(c.d)({name:"images"})(function(e){var t;return a.a.createElement("div",{ref:e.containerRef,className:Object(u.a)((t={},t[e.type]=!0,t))},e.children)}),d=n(45),h=n(90),p=n(585),g=n(610),f=n(586),b=n(5),m=n(153),w=n(28),y=function(){function e(e){this.loadingFailureCount=0,this.loadingFailureThreshold=3,this.isPageLoading=!1,this.isViewerLoaded=!1,this.loadingBlocked=!1,this.ajaxUrl="/search/result",this.ajaxParams={numdoc:String(e.numdoc),type:"images,querysearch,rtmr",images_commercial_organic:"0.0001",viewer:"1"},this.onLoadingFailure=this.onLoadingFailure.bind(this),this.onLoadingSuccess=this.onLoadingSuccess.bind(this),this.onViewerLoadingFailure=this.onViewerLoadingFailure.bind(this),this.onViewerLoadingSuccess=this.onViewerLoadingSuccess.bind(this),this.targetNode=e.targetNode,this.baobabNode=e.baobabNode,this.wzrdContext=e.wzrdContext}return e.prototype.loadPageData=function(e,t){if(!this.isPageLoading&&!this.loadingBlocked){this.isPageLoading=!0;var n={};this.loadingFailureCount&&(n.cache=!1),this.callbacks=t,this.pageNumber=e,Object(w.c)({adapter:"ImagesViewer",url:this.ajaxUrl,requestArguments:i.__assign({},this.ajaxParams,{p:String(e)}),settings:n,log:{event:w.a.append,node:this.baobabNode,isSubservice:!0}},{successCallback:this.onLoadingSuccess,failureCallback:this.onLoadingFailure})}},e.prototype.loadAndRenderViewer=function(){this.isPageLoading||this.isViewerLoaded||this.loadingBlocked||(this.isPageLoading=!0,Object(w.b)(this.targetNode,{adapter:"ImagesViewer",url:this.ajaxUrl,requestArguments:i.__assign({},this.ajaxParams,{p:"0"}),extraParams:{wzrdContext:this.wzrdContext},settings:{cache:!1},log:{event:w.a.append,node:this.baobabNode,isSubservice:!0}},{successCallback:this.onViewerLoadingSuccess,failureCallback:this.onViewerLoadingFailure}))},e.prototype.stopLoading=function(){this.loadingBlocked=!0},e.prototype.onViewerLoadingSuccess=function(e){this.isPageLoading=!1,this.isViewerLoaded=!0,e?this.loadingFailureCount=0:this.onViewerLoadingFailure()},e.prototype.onViewerLoadingFailure=function(){if(++this.loadingFailureCount<this.loadingFailureThreshold)return this.isPageLoading=!1,this.loadAndRenderViewer();this.stopLoading(),this.isPageLoading=!1,this.callbacks&&this.callbacks.failureCallback&&this.callbacks.failureCallback()},e.prototype.clearState=function(){this.callbacks=void 0,this.isPageLoading=!1},e.prototype.onLoadingFailure=function(){if(++this.loadingFailureCount<this.loadingFailureThreshold&&void 0!==this.pageNumber)return this.isPageLoading=!1,this.loadPageData(this.pageNumber,this.callbacks);this.stopLoading(),this.callbacks&&this.callbacks.failureCallback&&this.callbacks.failureCallback(),this.clearState()},e.prototype.onLoadingSuccess=function(e){e||this.onLoadingFailure(),this.loadingFailureCount=0,this.callbacks&&this.callbacks.successCallback&&this.callbacks.successCallback(e),this.clearState()},e}(),v=n(11),C=function(e){function t(t){var n=e.call(this,t)||this;return n.isViewerMounted=!1,n.containerRef=a.a.createRef(),n.onViewerMounted=n.onViewerMounted.bind(n),n}return i.__extends(t,e),t.prototype.render=function(){return a.a.createElement("div",{ref:this.containerRef})},t.prototype.componentDidMount=function(){Object(v.a)().on(m.ImagesViewerEvents.mounted,this.onViewerMounted),this.imageDataLoader||this.initDataLoader()},t.prototype.componentWillUnmount=function(){Object(v.a)().off(m.ImagesViewerEvents.mounted,this.onViewerMounted),this.imageDataLoader=void 0,this.isViewerMounted=!1},t.prototype.componentDidUpdate=function(){this.imageDataLoader||this.initDataLoader()},t.prototype.loadViewer=function(){this.imageDataLoader&&!this.isViewerMounted&&this.imageDataLoader.loadAndRenderViewer()},t.prototype.open=function(e){this.isViewerMounted?this.sendOpenSignal(e):(this.loadViewer(),this.docidRequested=e)},t.prototype.initDataLoader=function(){this.props.wzrdContext&&this.props.baobabId&&this.containerRef.current&&(this.imageDataLoader=new y({numdoc:this.props.numdoc,wzrdContext:this.props.wzrdContext,baobabNode:this.props.baobabId,targetNode:this.containerRef.current}))},t.prototype.onViewerMounted=function(){var e=this;this.isViewerMounted=!0,Object(v.a)().emit(m.ImagesViewerEvents.fill,{thumbs:this.props.thumbs,imageDataLoader:this.imageDataLoader}),this.docidRequested&&setTimeout(function(){e.docidRequested&&(e.sendOpenSignal(e.docidRequested),e.docidRequested=void 0)},0)},t.prototype.sendOpenSignal=function(e){Object(v.a)().emit(m.ImagesViewerEvents.open,{docid:e})},t}(a.a.Component),L=Object(b.withBaobab)({name:"images-viewer-container",extra:{id:!0,ref:!0},attrs:{subservice:"images"}})(function(e){return a.a.createElement(C,i.__assign({ref:e.forwardRef},e))});n.d(t,"a",function(){return _});var V=Object(o.compose)(g.a,f.a)(p.a),_=function(e){function t(t){var n=e.call(this,t)||this;return n.container=a.a.createRef(),n.viewerContainer=a.a.createRef(),n.state={},n.getThumbCreator=n.getThumbCreator.bind(n),n}return i.__extends(t,e),t.prototype.renderViewerContainer=function(){return this.props.isViewerEnabled&&this.props.thumbs&&this.props.wzrdContext?a.a.createElement(L,{forwardRef:this.viewerContainer,numdoc:Number(this.props.numdoc||20),thumbs:this.props.thumbs,wzrdContext:this.props.wzrdContext}):null},t.prototype.openThumbInViewer=function(e){return!!this.viewerContainer.current&&(this.viewerContainer.current.open(e),!0)},t.prototype.onThumbClickHandler=function(e){var t=this;return this.props.isViewerEnabled?function(n){t.openThumbInViewer(e)&&n.preventDefault()}:void 0},t.prototype.getThumbCreator=function(e,t,n){var r=this;return function(n,o,s){return a.a.createElement(e,i.__assign({className:n,forwardRef:o,onClick:r.onThumbClickHandler(t.docid||"")},t,{key:s}))}},t.prototype.getThumbs=function(){return this.props.thumbs},t.prototype.getGalleryDefault=function(e){var t=this,n=e.Gallery,r=e.Thumb,o=this.getThumbs();if(this.props.gallery&&o)return a.a.createElement(d.a,null,function(e){return a.a.createElement(n,i.__assign({},t.props.gallery,{more:t.props.more}),o.map(function(n){return n.map(function(n){return t.getThumbCreator(r,n,e)})}))})},t.prototype.getGallery=function(e){var t=e.Fold,n=this.getGalleryDefault(e);if(n)return this.props.fold&&(n=a.a.createElement(t,i.__assign({},this.props.fold),n)),n},t.prototype.render=function(){var e=this,t=this.getThumbs();return a.a.createElement(d.b,null,a.a.createElement(l,i.__assign({},this.props,{containerRef:this.container}),a.a.createElement(s.ComponentRegistryConsumer,{id:Object(u.a)()},function(n){var r=n.SerpOrganic;return a.a.createElement(h.a,null,a.a.createElement(r,i.__assign({},e.props.organic,{https:!0})),e.props.intents&&a.a.createElement(V,{colored:!0,theme:"images",colorScheme:"rainbow",items:e.props.intents}),e.props.gallery&&t&&t.length&&a.a.createElement(a.a.Fragment,null,e.getGallery(n),e.renderViewerContainer()))})))},t}(a.a.Component)}})});