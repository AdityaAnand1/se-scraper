Ya.define("static/features/Videowiz/Videowiz@desktop.en.js",["react-with-dom"],function(){!function(e){function t(t){for(var i,a,s=t[0],l=t[1],d=t[2],p=0,c=[];p<s.length;p++)a=s[p],n[a]&&c.push(n[a][0]),n[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(u&&u(t);c.length;)c.shift()();return o.push.apply(o,d||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],i=!0,s=1;s<r.length;s++){var l=r[s];0!==n[l]&&(i=!1)}i&&(o.splice(t--,1),e=a(a.s=r[0]))}return e}var i={},n={432:0},o=[];function a(t){if(i[t])return i[t].exports;var r=i[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=i,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(r,i,function(t){return e[t]}.bind(null,i));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="//yastatic.net/s3/web4static/_/";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var d=0;d<s.length;d++)t(s[d]);var u=l;o.push([2121,1,3,4,5,6,9,11,12,14,18,19,21,29,35,45,77,106,107,118,125,138,141,142,146,268,279,0]),r()}({0:function(e,t){e.exports=React},15:function(e,t){e.exports=ReactDOM},16:function(e,t,r){r.r(t);var i=r(6);Object(i.setI18nLang)("en")},2121:function(e,t,r){r(16),e.exports=r(3037)},2122:function(e,t,r){},2134:function(e,t,r){},2250:function(e,t,r){},2254:function(e,t,r){},3037:function(e,t,r){"use strict";r.r(t);var i,n=r(1),o=r(0),a=r.n(o),s=r(2),l=r(12),d=r(45),u=r(588),p=r(4),c=Object(p.cn)("Videowiz"),f=function(){for(var e=[],t=0;t<20;t++)e.push({stub:!0});return e}(),v=r(3382),m=(r(2122),a.a.memo(function(e){return a.a.createElement(v.a,n.__assign({className:c("Modal",{visible:e.visible})},e,{keepMounted:!1}),e.children)})),h=r(3357),g=r(3368),y=(r(2134),Object(h.a)(g.a)),b=r(3377),w=r(3359),S=r(3371);!function(e){e.open="viewer.open",e.playerInit="viewer.player.init",e.renderSerp="viewer.render.serp",e.renderRelated="viewer.render.related",e.playerFirstInit="viewer.player.first.init",e.fullInit="viewer.full.init"}(i||(i={}));var x={time:function(e){return window.Ya.Rum.time(e)},timeEnd:function(e){return window.Ya.Rum.timeEnd(e)}},P=Object(w.a)(S.a),I={rightSpace:0,minItemWidth:141,minItemMargin:10,maxItemMargin:185},_=function(e){function t(t){var r=e.call(this,t)||this;return r.onClickProvider=r.onClickProvider.bind(r),r}return n.__extends(t,e),t.prototype.getSnapshotBeforeUpdate=function(){return x.time(i.renderRelated),null},t.prototype.componentDidUpdate=function(){x.timeEnd(i.renderRelated)},t.prototype.render=function(){var e=this,t=this.props,r=t.snippets,i=t.currentSupportsNonStop;return a.a.createElement(b.a,n.__assign({className:c("Aligner")},I),r&&r.map(function(t,r){return a.a.createElement(b.c,{key:"aligner-item-"+r},function(n){var o=n.className;return(t.stub||t.title)&&a.a.createElement(P,{key:"video-related-"+t.filmId,className:o,next:0===r&&t.nonStopSupported&&i,onPreviewInit:e.props.onVideoPreviewInit(t),onPreviewPlay:e.props.onVideoPreviewPlay(t),url:t.title&&t.title.url,title:t.title&&t.title.text,video:t.thumb,preview:t.preview,onClick:e.onClickProvider(t),stub:t.stub})})}))},t.prototype.onClickProvider=function(e){var t=this;return function(){return t.props.onClick&&t.props.onClick(e)}},t}(a.a.PureComponent),C=new s.Registry({id:c()});C.set("VideowizRelatedSnippets",_).set("VideowizModal",m).set("VideowizViewer",function(e){return a.a.createElement(y,n.__assign({},e,{className:c("Viewer",[e.className]),theme:"default"}),function(t){var r=t.Header,i=t.Content;return a.a.createElement(a.a.Fragment,null,a.a.createElement(r,{tld:e.tld,lang:e.lang,yandexuid:e.yandexuid,lr:e.lr,onClose:e.onClose,onSuggestSubmit:e.onSuggestSubmit,query:e.query,visible:e.visible}),a.a.createElement(i,null,e.children&&e.children(t)))})});var O,R=r(838),V=r.n(R),q=r(3333),E=r(3363),k=r(3370),L=r(3374),z=r(3362),T=r(3369),j=r(475),D=r(52),M=r(13),U=function(){function e(){this.api="/video/result",this.requestMethod="GET",this.requestDelay=0}return e.prototype.encode=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e.prototype.ask=function(e,t){var r=this;this.request&&this.request.abort(),this.requestTimeout&&window.clearTimeout(this.requestTimeout),this.requestTimeout=window.setTimeout(function(){return r.request=Object(M.sendRequest)(r.api,{method:r.requestMethod,queryParams:r.filterQueryParams(e),format:"json"},r.wrapCallbacks({cb:t,urlParams:r.filterQueryParams(e)}))},this.requestDelay)},e.prototype.filterQueryParams=function(e){var t,r=this.normalizeQueryParams(e),i={};for(t in r)r[t]&&(i[t]=r[t]);return i},e.prototype.wrapCallbacks=function(e){return{successCallback:this.wrapSuccessCallback({callback:e.cb.successCallback,urlParams:e.urlParams}),failureCallback:e.cb.failureCallback}},e.setTestingTool=function(e){this.testingTool=e},e.getTestingTool=function(){return this.testingTool},e}(),N=r(6),H=r.n(N),B=r(1155),A=r(839),F=r(3111),Q=H()(F);!function(e){e.s200x112="s200x112",e.s175x98="s175x98"}(O||(O={}));var Y={s200x112:{w:200,h:112,x1:"200x112",x2:"400x224"},s175x98:{w:175,h:98,x1:"175x98",x2:"350x196"}},W=["entity_search","kino-vod-films-gallery","kino-vod-films-gallery","video_frame","video_thumb_fresh","vthumb","vh","ott"],J=new(function(){function e(){this.videoServiceUrl={baseUrl:"/video/search",searchParams:{}}}return e.prototype.setupVideoServiceUrl=function(e){var t=n.__read(e.split("?"),2),r=t[0],i=t[1];this.videoServiceUrl.baseUrl=r||this.videoServiceUrl.baseUrl,this.videoServiceUrl.searchParams=function(e){return e.split("&").map(function(e){var t,r=n.__read(e.split("="),2),i=r[0],o=r[1];return(t={})[i]=o,t}).reduce(function(e,t){return Object.assign(e,t)},{})}(i)},e.prototype.getImageUrl=function(e){var t=Y[e.thumbSize],r=e.href;if(!r)return r;if(0===r.indexOf("data:image"))return r;if(r.indexOf("//strm.yandex.ru/vh-ott-converted")>-1)return r;if(!t||!t.w&&!t.h)return r;var i=t.w||0,n=t.h||0,o=t.n||1040;return(r=-1===r.indexOf("?")?function(e,t,r,i){var n=function(e){var t=e.split("/get-");if(2!==t.length)return null;var r=t[1].split("/");if(r.length<3||!r[2])return null;return{namespace:r[0],host:t[0],parts:r}}(e),o=n&&n.namespace,a=function(e,t,r){if(200===e&&112===t)return 2===r?Y.s200x112.x2:Y.s200x112.x1;if(175===e&&98===t)return 2===r?Y.s175x98.x2:Y.s175x98.x1;return}(t,r,i);if(!n||!o||-1===W.indexOf(o)||!a)return e;return n.parts[3]=a,n.host+"/get-"+n.parts.join("/")}(r,i,n,e.isRetina?2:1):function(e,t,r,i,n){t*=n,r*=n,e=e.replace(/\&?$/,"&"),e+="n="+i,t&&(e+="&w="+t);r&&(e+="&h="+r);return e}(r,i,n,o,e.isRetina?2:1)).replace(/^(https?:|)/,"")},e.prototype.getQuality=function(e,t,r){return t&&t>=1?B.b.dHD:r&&r>=1?B.b.FullHD:e&&e>=4?B.b.HD:void 0},e.prototype.getItemUrlVideoService=function(e){var t=e.urlParams||{},r=this.videoServiceUrl.baseUrl,i=Object.assign({},this.videoServiceUrl.searchParams);for(var n in i.filmId=e.filmid,t){var o=t[n];o&&(i[n]=o.toString())}return Object(M.appendQueryString)(r,i)},e.prototype.getItemDuration=function(e){var t="",r="string"===typeof e?parseInt(e,10):e;return r?t=Object(A.a)(r,!0):"string"===typeof e&&-1!==e.indexOf(":")&&(t=e),t},e}());function K(e){var t,r,i=e.HtmlAutoplayVideoPlayer||e.HtmlVideoPlayer;return/^<iframe src="\/\/yastatic\.net\//.test(i)?(r=(t=i)&&t.match(/src=(['"]{1})(\S+)['"]{1}/))?r[2]:"":function(e,t,r,i){void 0===i&&(i="");var n="//yastatic.net/video-player/"+(e||"0x56dc83d0d7")+"/pages-common/",o=function(e){return e?e.indexOf("dailymotion")>-1?"dailymotion":e.indexOf("izlesene")>-1?"izlesene":["mailru","video.mail.ru"].indexOf(e)>-1?"mailru":e.indexOf("rutube")>-1?"rutube":e.indexOf("vimeo")>-1?"vimeo":e.indexOf("youtube")>-1?"youtube":e.indexOf("pre-post-roll")>-1?"pre-post-roll":"default":"default"}(t);return("hermione"===i?"/iframe-video-stub/":"")+n+o+"/"+o+".html#"+r}("0x56dc83d0d7",e.PlayerId||"","html="+encodeURIComponent(e.HtmlAutoplayVideoPlayer||e.HtmlVideoPlayer),U.getTestingTool()||"")}var G=function(e){return e.green?"//favicon.yandex.net/favicon/"+e.green.text+"/?color=255%2C255%2C255%2C0":""},X=function(e){return[].concat(e).map(function(e){return(e||"").replace(/\[/g,"").replace(/\]/g,"")}).join(" ")};var $=r(340),Z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.TYPE_PREPARED_REGEXP=/_+/g,t}return n.__extends(t,e),t.prototype.normalizeQueryParams=function(e){var t={text:this.encode(e.query),source:"viewer-tech",path:e.fromWizard?"wizard":"snippet","parent-reqid":e["parent-reqid"],noreask:e.noreask?1:void 0,url:e.mustBeInResponse};return e.p&&(t.p=e.p),t},t.prototype.wrapSuccessCallback=function(e){var t=this;return function(r,i){var n=r.clips.map(function(e){return Object($.c)(e)?t.normalizeBlender(e):t.normalizeVideoSnippet(e,r.reqid)},t);e.callback&&e.callback({reqid:r.reqid,clips:n},i)}},t.prototype.normalizeVideoSnippet=function(e,t){return{nonStopSupported:Object(k.c)(e.PlayerId),filmId:e.videoid,duration:e.dur||e.duration,origin:e.clip_href,title:{url:J.getItemUrlVideoService({filmid:e.videoid}),text:e.raw_title},green:{url:e.clip_href,text:e.green_host},description:e.raw_pass,player:K(e),playerId:e.PlayerId,isPorno:e.IsPornoDoc,thumb:{hd:J.getQuality(e.vhd,e.vdeephd,e.v1080hd),duration:J.getItemDuration(e.dur||e.duration),image:J.getImageUrl({href:e.thmb_href_ext||e.thmb_href,thumbSize:O.s200x112})},views:Number(e.views),preview:e.previews&&e.previews[0],extra:e.extra&&{related:e.extra.related},isPartner:Boolean(e.ads&&!e.ads.organic),reqid:t,stub:e.stub,time:"string"===typeof e.mtime?new Date(e.mtime.slice(0,e.mtime.length-5)):null,isOld:!e.is_fresh,isFavorite:Boolean(e.collections_favorites),placeholderImg:e.img_href}},t.prototype.normalizeBlender=function(e){var t=e._SerpInfo.type,r=e._SerpInfo.subtype;return{type:t.replace(this.TYPE_PREPARED_REGEXP,"-"),subtype:r?r.replace(this.TYPE_PREPARED_REGEXP,"-"):"",groupdId:e.group_id,directId:e._SerpData.directId}},t}(U),ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.normalizeQueryParams=function(e){return{related_src:e.related_src,no_cnt:e.no_cnt,relatedVideo:e.relatedVideo,related_vfp:e.related_vfp,related_category:e.related_category,related:e.related,related_url:e.related_url,related_season:e.related_season,related_episode:e.related_episode,related_porno:e.related_porno||void 0,text:e.text,"parent-reqid":e["parent-reqid"],numdoc:20,page:"search",exp_flags:e.exp_flags}},t.prototype.wrapSuccessCallback=function(e){return function(t,r){var i=t.clips.map(function(r,i){return{nonStopSupported:Object(k.c)(r.PlayerId),position:i+1,filmId:r.videoid,duration:r.dur||r.duration,origin:r.clip_href,title:{url:J.getItemUrlVideoService({filmid:r.videoid,urlParams:e.urlParams}),text:r.raw_title},green:{url:r.clip_href,text:r.green_host},description:r.raw_pass,player:K(r),thumb:{hd:J.getQuality(r.vhd,r.vdeephd,r.v1080hd),duration:J.getItemDuration(r.dur||r.duration),image:J.getImageUrl({href:r.thmb_href_ext||r.thmb_href,thumbSize:O.s175x98})},extra:r.extra&&{related:r.extra.related},preview:r.previews&&r.previews[0],reqid:t.reqid,stub:r.stub,playerId:r.PlayerId,isPorno:r.IsPornoDoc,time:"string"===typeof r.mtime?new Date(r.mtime.slice(0,r.mtime.length-5)):null,isOld:!r.is_fresh,isFavorite:Boolean(r.collections_favorites),placeholderImg:r.img_href}});e.callback&&e.callback({reqid:t.reqid,clips:i},r)}},t}(U),te=(r(2250),Object(p.cn)("VideoOrganicList")),re=r(840),ie=r(7);r(2254);r(2246);var ne=r(621),oe=ne.disableBodyScroll,ae=ne.enableBodyScroll,se=function(){},le=function(e,t){return e.filter(function(e){return e.filmId===t})[0]},de=function(e){return e?encodeURIComponent(e).replace(/\*/g,"%2A"):""},ue=Object(z.a)(T.a),pe=function(e){function t(t){var r=e.call(this,t)||this;return r.state=n.__assign({},r.getDefaultState(),{reqid:r.props.reqid,query:""}),r.videoOrganicRefs={},r.sidebarRef=a.a.createRef(),r.prevLocation="",r.firstPlayerInitLogged=!1,r.fullInitLogged=!1,r.moreSnippetsRequested=!1,r.pageToLoad=1,r.videoClipsCount=0,r.lastOrganicSnippet=null,r.suggestQuery="",r.sidebarScrollTop=0,r.videowizOpened=!1,r.fromWizard=!1,r.scrolledOnOpen=!1,r.onNewUrlReceived=function(){x.time(i.playerInit)},r.onPlayerInited=function(){x.timeEnd(i.playerInit),r.firstPlayerInitLogged||(x.timeEnd(i.playerFirstInit),r.firstPlayerInitLogged=!0),r.state.iframeLoading&&(clearTimeout(r.iframeLoadingTimer),r.setState({iframeLoading:!1},r.loadRelatedSnippets))},r.open=r.open.bind(r),r.onLog=r.onLog.bind(r),r.onKeyDown=r.onKeyDown.bind(r),r.sendCounter=r.sendCounter.bind(r),r.onCloseClick=r.onCloseClick.bind(r),r.loadSnippets=r.loadSnippets.bind(r),r.safeMouseEvent=r.safeMouseEvent.bind(r),r.setCurrentVideo=r.setCurrentVideo.bind(r),r.onNextVideoPlay=r.onNextVideoPlay.bind(r),r.onSidebarScroll=r.onSidebarScroll.bind(r),r.onVideoPreviewInit=r.onVideoPreviewInit.bind(r),r.onVideoPreviewPlay=r.onVideoPreviewPlay.bind(r),r.loadRelatedSnippets=r.loadRelatedSnippets.bind(r),r.forwardToVideoService=r.forwardToVideoService.bind(r),r.provideRelatedVideoHandler=r.provideRelatedVideoHandler.bind(r),r.onRelatedLoadingSuccessCreator=r.onRelatedLoadingSuccessCreator.bind(r),r.onSnippetsLoadingSuccessCreator=r.onSnippetsLoadingSuccessCreator.bind(r),r.onMoreSnippetsLoadingSuccessCreator=r.onMoreSnippetsLoadingSuccessCreator.bind(r),r}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props.counters;this.prevLocation=window.location.href,window.onpopstate=function(){return-1!==e.prevLocation.indexOf("/videowiz")&&e.close()},document.addEventListener("keydown",this.onKeyDown,!1),this.snippetsVideoHandler=new Z,this.relatedVideoHandler=new ee,window.Ya.MediaViewer=window.Ya.MediaViewer||{},window.Ya.MediaViewer.open=this.open,window.Ya.MediaViewer.mount(),this.hit=Object(q.b)(!1),this.sendCounter(t.videowizInit)},t.prototype.componentDidUpdate=function(e,t){var r=this.state,n=r.visible,o=r.current,a=this.props.counters,s=t.visible!==n,l=this.state.iframeLoading&&!t.iframeLoading,d=Object.keys(this.videoOrganicRefs).length;if(t.visible!==n&&(n?oe():ae()),d&&x.timeEnd(i.renderSerp),n&&s&&this.sendCounter(a.videowizShow,o&&o.origin?{videoUrl:o.origin}:{}),l&&(this.iframeLoadingTimer=window.setTimeout(this.onPlayerInited,q.c)),o){var u=this.videoOrganicRefs[o.filmId];!this.scrolledOnOpen&&d&&u&&u.current&&this.sidebarRef.current&&(this.scrolledOnOpen=!0,V()(u.current,{offset:-u.current.offsetHeight/2,element:this.sidebarRef.current}))}},t.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.onKeyDown,!1),window.clearTimeout(this.snippetLoadingTimer)},t.prototype.onSidebarScroll=function(){var e=this.sidebarRef.current,t=this.lastOrganicSnippet&&this.lastOrganicSnippet.current;e&&t&&(this.sidebarScrollTop<e.scrollTop&&e.scrollTop+e.clientHeight>t.offsetTop&&this.loadSnippets({p:this.pageToLoad,query:this.suggestQuery}),this.sidebarScrollTop=e.scrollTop)},t.prototype.render=function(){var e,t,r,i,n,o,l=this,d=this.state,u=d.current,p=d.query,f=d.visible,v=d.relatedSnippets,m=d.organicSnippets,h=this.props,g=h.counters,y=h.reqid,b=h.query,w=h.tld,S=h.lr,x=h.yandexuid,P=h.lang,I=h.loggedIn,_=this.renderOrganicSnippets(),C=v[0],O=Boolean(u&&u.nonStopSupported&&C&&C.player&&C.player!==u.player),R="https://passport.yandex."+w+"/auth?retpath="+encodeURIComponent("https://yandex."+w+"/collections/favorites-video/");return u&&(e=u&&u.green&&u.green.text,t=u&&u.origin,r=u&&G(u),i=u&&u.isFavorite,n=function(e,t){var r=X(e.title&&e.title.text||"");return{doc_id:e.filmId,description:r,content:[{source_type:"video",source:{preview:e.placeholderImg||e.thumb&&e.thumb.image||"",url:e.origin,metadata:{duration:e.duration}}}],source_meta:{page_title:r,page_url:e.green&&e.green.url||"",page_domain:"yandex."+t+"/video"}}}(u,w),o=u.title&&u.title.url),a.a.createElement("div",{className:c()},a.a.createElement(s.ComponentRegistryConsumer,{id:c()},function(s){var d=s.VideowizModal,u=s.VideowizViewer,h=s.VideowizRelatedSnippets;return a.a.createElement(d,{visible:f},a.a.createElement(u,{tld:w,lr:S,lang:P,yandexuid:x,query:p||b,className:c("Viewer",{visible:f}),onSuggestSubmit:l.forwardToVideoService,visible:f,onClose:l.onCloseClick},function(s){var d=s.Sidebar,u=s.Preview,b=s.Title,w=s.MoreLink;return a.a.createElement(a.a.Fragment,null,a.a.createElement(u,null,a.a.createElement(b,{isFavoritesButton:!0,isShareButton:!0,host:e,origin:t,iconSrc:r,onLog:l.onLog,card:n,isFavorite:i,loginUrl:R,shareUrl:o,loggedIn:I}),l.renderPlayer(),f&&a.a.createElement(h,{snippets:v,onClick:l.provideRelatedVideoHandler,onVideoPreviewInit:l.onVideoPreviewInit,onVideoPreviewPlay:l.onVideoPreviewPlay,currentSupportsNonStop:O})),a.a.createElement(d,{forwardRef:l.sidebarRef,onScroll:l.onSidebarScroll},_,m.length?a.a.createElement(L.a,{progress:Boolean(l.state.moreSnippetsLoading),className:c("Spinner")},a.a.createElement(w,{query:p,cgi:{p:String(Math.floor(m.length/20)),"parent-reqid":y,source:"videoviewer-more"},counter:g.viewerMoreLink})):null))}))}))},t.prototype.getDefaultState=function(){return{visible:!1,current:void 0,relatedSnippets:f,organicSnippets:[],iframeLoading:!1,moreSnippetsLoading:!1}},t.prototype.open=function(e){var t=this,r=e.filmId,n=e.query,o=e.videoServiceUrl,a=e.origin,s=e.fromWizard,l=this.props.experiments,d=this.state.organicSnippets;this.videowizOpened=!0,this.fromWizard=s,this.pushHistory(r),J.setupVideoServiceUrl(o),l.testTool&&U.setTestingTool(l.testTool);var u=le(d,r)||{filmId:r,origin:a};u&&u.origin&&(u.nonStopSupported=Object(k.d)(u.origin));var p={current:u,visible:!0,iframeLoading:!0,organicSnippets:f,query:n||this.props.query};this.setState(p,function(){x.timeEnd(i.open),t.loadSnippets({mustBeInResponse:u.origin})})},t.prototype.pushHistory=function(e){if(-1===window.location.href.indexOf("/videowiz")){var t=window.location.href+"#/videowiz?filmId="+e;window.history.pushState({},"Videowiz",t),this.prevLocation=t}else{t=this.prevLocation.split("#/videowiz")[0]+"#/videowiz?filmId="+e;window.history.replaceState({},"Videowiz",t),this.prevLocation=t}},t.prototype.onLog=function(e){var t=this.props.counters[e];t&&this.sendCounter(t)},t.prototype.sendCounter=function(e,t){Object(ie.c)(e.counter,n.__assign({V:this.state.reqid},t))},t.prototype.sendClckCounter=function(e,t){var r=e.origin,i=e.title,n=Number(new Date);if(this.hit){var o=de(r),a=de(i&&i.url),s="sandbox-counter:/jclck/reqid="+this.state.reqid+"/rnd="+n+"/yuid=${yuid}/cid=73001/path="+t.logNode.name+"/vars=-type=video,-url="+o+"/dtype=stred/pid=197/*data=url%3D"+a;this.hit(s)}},t.prototype.onMoreSnippetsLoadingSuccessCreator=function(e){var t=this;return void 0===e&&(e=se),function(r){var i=r.clips,o=t.state.organicSnippets,a=n.__spread(o,i),s=a.filter(function(e){return!Object($.b)(e)}),l={organicSnippets:a,moreSnippetsLoading:!1};return t.videoClipsCount=s.length,t.setState(l,e)}},t.prototype.loadSnippets=function(e,t){var r=this;if(void 0===t&&(t=se),e&&Boolean(e.p)){if(this.moreSnippetsRequested)return;this.setState({moreSnippetsLoading:!0}),this.moreSnippetsRequested=!0}var i=this.props,n=i.counters,o=i.tld,a=this.state,s=a.query,l=a.reqid,d=a.current,u=e&&Boolean(e.p)?this.onMoreSnippetsLoadingSuccessCreator:this.onSnippetsLoadingSuccessCreator,p=e&&e.query?e.query:s,c=Boolean(d&&d.origin&&-1!==d.origin.indexOf("&noreask=1")),f=e?e.mustBeInResponse:void 0;p&&this.snippetsVideoHandler&&this.snippetsVideoHandler.ask({tld:o,noreask:c,mustBeInResponse:f,query:p,"parent-reqid":l,p:e&&e.p,fromWizard:Boolean(this.fromWizard)},{successCallback:u(t),failureCallback:function(){return r.sendCounter(n.videowizAjaxOrganicSnippetsFail)}})},t.prototype.loadRelatedSnippets=function(){var e=this.props,t=e.counters,r=e.tld,i=this.state.current;i&&i.extra&&this.relatedVideoHandler&&this.relatedVideoHandler.ask(n.__assign({tld:r},i.extra.related),{successCallback:this.onRelatedLoadingSuccessCreator(),failureCallback:function(){return Object(ie.c)(t.videowizAjaxRelatedSnippetsFail.counter)}})},t.prototype.onRelatedLoadingSuccessCreator=function(){var e=this,t=this.props.counters;return function(r){return e.setState({relatedSnippets:r.clips},function(){return n=r.clips.length,Object(ie.c)(t.videowizAjaxRelatedSnippets.counter,{count:String(n)}),void(e.fullInitLogged||(x.timeEnd(i.fullInit),e.fullInitLogged=!0));var n})}},t.prototype.onSnippetsLoadingSuccessCreator=function(e){var t=this;void 0===e&&(e=se);var r=this.props.counters,n=this.state.iframeLoading;return function(o){var a=o.reqid,s=o.clips,l=t.state.current,d=s.filter(function(e){return!Object($.b)(e)}),u=l?le(d,l.filmId):void 0;!u&&l&&l.filmId&&t.sendCounter(r.videowizAjaxOrganicSnippetsDelta,{misFilmIds:l.filmId}),x.time(i.renderSerp),u||(u=d[0])&&t.pushHistory(u.filmId);var p={reqid:a,organicSnippets:s,current:u,iframeLoading:n};return t.videoClipsCount=d.length,t.setState(p,function(){t.sendCounter(r.videowizAjaxOrganicSnippets,{count:String(d.length)}),e()})}},t.prototype.close=function(){this.videowizOpened&&(this.videowizOpened=!1,clearTimeout(this.iframeLoadingTimer),this.sendCounter(this.props.counters.viewerClose),this.setState(this.getDefaultState()),this.moreSnippetsRequested=!1,this.suggestQuery="",this.scrolledOnOpen=!1)},t.prototype.onCloseClick=function(){this.close(),window.history.back()},t.prototype.onKeyDown=function(e){this.state.visible&&"Textinput-Control"!==e.target.className&&(e.preventDefault(),e.stopPropagation(),27===e.keyCode&&this.onCloseClick())},t.prototype.safeMouseEvent=function(e){e.stopPropagation()},t.prototype.onVideoPreviewInit=function(e){var t=this;return function(){return t.sendClckCounter(e,t.props.counters.videoPreviewInit)}},t.prototype.onVideoPreviewPlay=function(e){var t=this;return function(){return t.sendClckCounter(e,t.props.counters.videoPreviewPlay)}},t.prototype.setCurrentVideo=function(e){var t=this,r=this.state.organicSnippets;return function(){t.setState({current:le(r,e),iframeLoading:!0},function(){t.pushHistory(e)})}},t.prototype.provideRelatedVideoHandler=function(e){return this.setState({current:e},this.loadRelatedSnippets)},t.prototype.onNextVideoPlay=function(e){var t=this;return function(){return t.provideRelatedVideoHandler(e)}},t.prototype.forwardToVideoService=function(e){window.open("/video/search?text="+encodeURIComponent(e)+"&parent-reqid="+this.state.reqid+"&source=videoviewer-suggest")},t.prototype.renderPlayer=function(){var e,t,r,i=this.props.counters,n=this.state,o=n.reqid,s=n.current,l=n.organicSnippets,d=n.relatedSnippets,u=n.iframeLoading,p=d[0],f=[],v=null;if(s&&s.player){var m=-1!==d.indexOf(s);f.push({player:s.player,duration:s.duration,host:s.green&&s.green.text,origin:s.origin,filmId:s.filmId,title:s.title&&s.title.text,reqid:s.reqid||o,position:s.position||l.indexOf(s)+1,videoUrl:s.title&&s.title.url,counters:(e={},e[q.e]=m?i.videoOpenRelatedPlayer:i.videoOpenPlayer,e[q.d]=i.videoDurationPlayer,e),isPorno:s.isPorno,playerId:s.playerId}),p&&p.nonStopSupported&&s.nonStopSupported&&p.player!==s.player&&f.push({player:p.player,duration:p.duration,host:p.green&&p.green.text,origin:p.origin,filmId:p.filmId,title:p.title&&p.title.text,reqid:p.reqid,faviconProps:{pageNumber:0,index:0,size:16,url:G(p)},position:0,videoUrl:p.title&&p.title.url,counters:(t={},t[q.e]=i.videoOpenRelatedNonStopPlayer,t[q.d]=i.videoDurationPlayer,t),isPorno:p.isPorno,playerId:p.playerId}),v=a.a.createElement(k.a,{onInited:this.onPlayerInited,onIframeLoad:this.onPlayerInited,fullwidth:!0,playlist:f,onNextVideoPlay:this.onNextVideoPlay(p),onNewUrlReceived:this.onNewUrlReceived,onComponentDidMount:this.onNewUrlReceived}),r=s.placeholderImg}return a.a.createElement("div",{style:{flexShrink:0}},a.a.createElement(re.a,{src:r,visible:u},a.a.createElement(L.a,{progress:u,className:c("Spinner",{empty:!s||!s.player},[c("Player")])},v)))},t.prototype.renderOrganicSnippets=function(){var e=this,t=this.props.counters,r=this.state,i=r.current,o=r.organicSnippets,s=r.query,l=r.reqid;this.videoOrganicRefs={};var d=[],u=0,p="";return o.forEach(function(r,o){if(Object($.b)(r))d.push(a.a.createElement($.a,{className:te("Item"),scrollableContainer:e.sidebarRef,counters:{videowizDirectUpdate:t.videowizDirectUpdate},blenderData:r,reqid:l,query:s||"",index:o}));else if(r.stub)d.push(a.a.createElement(ue,{className:c("Organic",[te("Item")]),key:"video-organic-"+o,preventNavigate:!0,stub:!0}));else{u%20===0&&e.videoClipsCount>o+1&&0!==u&&(p=String(Math.ceil(u/20)+1),d.push(a.a.createElement(E.a,{text:p,key:"divider-"+p})));var f=a.a.createRef(),v=i&&i.filmId&&i.filmId===r.filmId,m={pageNumber:999,index:0,size:16,url:G(r)};e.videoOrganicRefs[r.filmId]||(e.videoOrganicRefs[r.filmId]=f),o+1===e.videoClipsCount&&(e.lastOrganicSnippet=f);var h,g={text:function(e){if(null===e)return"";var t=new Date,r=(t.valueOf()-e.valueOf())/1e3,i=r/60,n=i/60,o=n/24;if(r<60)return Q("{count} секунд",{count:Math.floor(r)});if(i<60)return Q("{count} минут",{count:Math.floor(i)});if(n<24)return Q("{count} часов",{count:Math.floor(n)});if(o>=1&&o<2)return Q("вчера");var a=t.getFullYear()===e.getFullYear(),s=e.getDate()+" "+Q(["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"][e.getMonth()]);return a||(s+=" "+e.getFullYear()),s}(r.time),old:r.isOld};r.title&&r.description&&r.green&&(d.push(a.a.createElement(ue,{preventNavigate:!0,forwardRef:f,key:"video-organic-"+o,className:c("Organic",[te("Item")]),title:r.title.text,url:r.title.url,path:[n.__assign({},r.green,{counter:t.organicSubtitle,onClick:e.safeMouseEvent})],favicon:m,isPartner:r.isPartner,text:(h=r.description,[].concat(h).map(function(e){return e?Object(D.markup)(e,{textPreprocessor:j.decodeHTMLEntities}):""})),views:r.views,date:g,onClick:!v&&i?e.setCurrentVideo(r.filmId):void 0,video:r.thumb,preview:r.preview,selected:Boolean(v),onPreviewInit:e.onVideoPreviewInit(r),onPreviewPlay:e.onVideoPreviewPlay(r)})),u++)}}),d},t}(a.a.PureComponent);r.d(t,"App",function(){return fe});var ce={},fe=Object(l.a)("Videowiz")(function(e){var t=[C];for(var r in e.experiments){var i=r,o=e.experiments[i],l=ce[i];if(l&&o){var p=l[o];p&&t.push(p)}}var c=s.withRegistry.apply(void 0,n.__spread(t))(pe),f=e.experiments.directAutoupdateTimeout;return a.a.createElement(d.b,null,a.a.createElement(ie.b,{value:e.videowiz.counters},a.a.createElement(u.b,{value:{blenderExpParams:f?{directAutoupdateTimeout:f}:void 0}},a.a.createElement(d.a,null,function(t){var r=t.reqid,i=t.query,o=t.tld,s=t.yandexuid,l=t.lr,d=t.lang,u=t.login;return a.a.createElement(c,n.__assign({},e.videowiz,{reqid:r,query:i,tld:o,lang:d,lr:l,yandexuid:s,loggedIn:""!==u,experiments:e.experiments}))}))))})},3111:function(e,t,r){r.r(t);var i=r(3870);r.d(t,"en",function(){return i.a})},3870:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i={"января":"January","февраля":"February","марта":"March","апреля":"April","мая":"May","июня":"June","июля":"July","августа":"August","сентября":"September","октября":"October","ноября":"November","декабря":"December","вчера":"yesterday","{count} часов":{none:"",one:"{count} hour",some:"{count} hours",many:"{count} hours"},"{count} минут":{none:"",one:"{count} min",some:"{count} min",many:"{count} min"},"{count} секунд":{none:"",one:"{count} sec",some:"{count} sec",many:"{count} sec"}}}})});